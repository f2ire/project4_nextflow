args = commandArgs(trailingOnly = TRUE)

library(numbat)
count_mat_ATC2_to_dl = args[1]
count_mat_ATC2 = readRDS(url(count_mat_ATC2_to_dl))

ref_hca = args[2]

df_allele_ATC2_to_dl = args[3]
df_allele_ATC2 = readRDS(url(df_allele_ATC2_to_dl))

genome = args[4]
t = args[5]
ncores = args[6]
out_dir = args[7]

# run
out = run_numbat(
  count_mat_ATC2, # gene x cell integer UMI count matrix 
  ref_hca, # reference expression profile, a gene x cell type normalized expression level matrix
  df_allele_ATC2, # allele dataframe generated by pileup_and_phase script
  genome = "hg38",
  t = 1e-5,
  ncores = 4,
  plot = TRUE,
  out_dir = '/home/qohayon/Bureau/test'
)

